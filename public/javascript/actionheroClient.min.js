!function(e,t,n,o){t[e]=n.call(t);for(var r=0;r<o.length;r++)o[r](t[e]);"undefined"!=typeof module&&module.exports?module.exports=t[e]:"function"==typeof define&&define.amd&&define(function(){return t[e]})}("Primus",this||{},function(){var e,t=function e(t,n,o){function r(s,c){if(!n[s]){if(!t[s]){var a="function"==typeof require&&require;if(!c&&a)return a(s,!0);if(i)return i(s,!0);var u=new Error("Cannot find module '"+s+"'");throw u.code="MODULE_NOT_FOUND",u}var p=n[s]={exports:{}};t[s][0].call(p.exports,function(e){var n=t[s][1][e];return r(n?n:e)},p,p.exports,e,t,n,o)}return n[s].exports}for(var i="function"==typeof require&&require,s=0;s<o.length;s++)r(o[s]);return r}({1:[function(e,t,n){"use strict";t.exports=function(e,t){function n(e,n){if(t[e]){if("string"==typeof t[e]&&(t[e]=t[e].split(o)),"function"==typeof t[e])return t[e].call(n);for(var r,i,s=0;s<t[e].length;s++)i=t[e][s],r=typeof i,"function"===r?i.call(n):"string"===r&&"function"==typeof n[i]&&n[i]()}}var o=/[, ]+/;return t=t||{},e=e||[],"string"==typeof e&&(e=e.split(o)),function(){var t,o=this,r=0;if(null===o[e[0]])return!1;for(n("before",o);r<e.length;r++)t=e[r],o[t]&&("function"==typeof o[t].destroy&&o[t].destroy(),o[t]=null);return o.emit&&o.emit("destroy"),n("after",o),!0}}},{}],2:[function(e,t,n){"use strict";t.exports=function(){for(var e,t=this,n=0,o=arguments.length,r=new Array(o);n<o;n++)r[n]=arguments[n];return"function"!=typeof r[r.length-1]?function(){for(var e=0,n=arguments.length,o=new Array(n);e<n;e++)o[e]=arguments[e];return t.emit.apply(t,r.concat(o))}:(e=r.pop(),function(){for(var n=0,o=arguments.length,i=new Array(o+1);n<o;n++)i[n+1]=arguments[n];return i[0]=function(e,n){return e?t.emit("error",e):(i=void 0===n?i.slice(1):null===n?[]:n,void t.emit.apply(t,r.concat(i)))},e.apply(t,i),!0})}},{}],3:[function(e,t,n){"use strict";function o(){}function r(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function i(){this._events=new o,this._eventsCount=0}var s=Object.prototype.hasOwnProperty,c="~";Object.create&&(o.prototype=Object.create(null),(new o).__proto__||(c=!1)),i.prototype.eventNames=function(){var e,t,n=[];if(0===this._eventsCount)return n;for(t in e=this._events)s.call(e,t)&&n.push(c?t.slice(1):t);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(e)):n},i.prototype.listeners=function(e,t){var n=c?c+e:e,o=this._events[n];if(t)return!!o;if(!o)return[];if(o.fn)return[o.fn];for(var r=0,i=o.length,s=new Array(i);r<i;r++)s[r]=o[r].fn;return s},i.prototype.emit=function(e,t,n,o,r,i){var s=c?c+e:e;if(!this._events[s])return!1;var a,u,p=this._events[s],f=arguments.length;if(p.fn){switch(p.once&&this.removeListener(e,p.fn,void 0,!0),f){case 1:return p.fn.call(p.context),!0;case 2:return p.fn.call(p.context,t),!0;case 3:return p.fn.call(p.context,t,n),!0;case 4:return p.fn.call(p.context,t,n,o),!0;case 5:return p.fn.call(p.context,t,n,o,r),!0;case 6:return p.fn.call(p.context,t,n,o,r,i),!0}for(u=1,a=new Array(f-1);u<f;u++)a[u-1]=arguments[u];p.fn.apply(p.context,a)}else{var l,h=p.length;for(u=0;u<h;u++)switch(p[u].once&&this.removeListener(e,p[u].fn,void 0,!0),f){case 1:p[u].fn.call(p[u].context);break;case 2:p[u].fn.call(p[u].context,t);break;case 3:p[u].fn.call(p[u].context,t,n);break;case 4:p[u].fn.call(p[u].context,t,n,o);break;default:if(!a)for(l=1,a=new Array(f-1);l<f;l++)a[l-1]=arguments[l];p[u].fn.apply(p[u].context,a)}}return!0},i.prototype.on=function(e,t,n){var o=new r(t,n||this),i=c?c+e:e;return this._events[i]?this._events[i].fn?this._events[i]=[this._events[i],o]:this._events[i].push(o):(this._events[i]=o,this._eventsCount++),this},i.prototype.once=function(e,t,n){var o=new r(t,n||this,!0),i=c?c+e:e;return this._events[i]?this._events[i].fn?this._events[i]=[this._events[i],o]:this._events[i].push(o):(this._events[i]=o,this._eventsCount++),this},i.prototype.removeListener=function(e,t,n,r){var i=c?c+e:e;if(!this._events[i])return this;if(!t)return 0===--this._eventsCount?this._events=new o:delete this._events[i],this;var s=this._events[i];if(s.fn)s.fn!==t||r&&!s.once||n&&s.context!==n||(0===--this._eventsCount?this._events=new o:delete this._events[i]);else{for(var a=0,u=[],p=s.length;a<p;a++)(s[a].fn!==t||r&&!s[a].once||n&&s[a].context!==n)&&u.push(s[a]);u.length?this._events[i]=1===u.length?u[0]:u:0===--this._eventsCount?this._events=new o:delete this._events[i]}return this},i.prototype.removeAllListeners=function(e){var t;return e?(t=c?c+e:e,this._events[t]&&(0===--this._eventsCount?this._events=new o:delete this._events[t])):(this._events=new o,this._eventsCount=0),this},i.prototype.off=i.prototype.removeListener,i.prototype.addListener=i.prototype.on,i.prototype.setMaxListeners=function(){return this},i.prefixed=c,i.EventEmitter=i,"undefined"!=typeof t&&(t.exports=i)},{}],4:[function(e,t,n){"function"==typeof Object.create?t.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:t.exports=function(e,t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}},{}],5:[function(e,t,n){"use strict";var o=new RegExp("^((?:\\d+)?\\.?\\d+) *("+["milliseconds?","msecs?","ms","seconds?","secs?","s","minutes?","mins?","m","hours?","hrs?","h","days?","d","weeks?","wks?","w","years?","yrs?","y"].join("|")+")?$","i"),r=1e3,i=60*r,s=60*i,c=24*s,a=7*c,u=365*c;t.exports=function(e){var t,n,p=typeof e;if("number"===p)return e;if("string"!==p||"0"===e||!e)return 0;if(+e)return+e;if(e.length>1e4||!(n=o.exec(e)))return 0;switch(t=parseFloat(n[1]),n[2].toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return t*u;case"weeks":case"week":case"wks":case"wk":case"w":return t*a;case"days":case"day":case"d":return t*c;case"hours":case"hour":case"hrs":case"hr":case"h":return t*s;case"minutes":case"minute":case"mins":case"min":case"m":return t*i;case"seconds":case"second":case"secs":case"sec":case"s":return t*r;default:return t}}},{}],6:[function(e,t,n){"use strict";t.exports=function(e){function t(){return o?n:(o=1,n=e.apply(this,arguments),e=null,n)}var n,o=0;return t.displayName=e.displayName||e.name||t.displayName||t.name,t}},{}],7:[function(e,t,n){"use strict";function o(e){for(var t,n=/([^=?&]+)=?([^&]*)/g,o={};t=n.exec(e);o[decodeURIComponent(t[1])]=decodeURIComponent(t[2]));return o}function r(e,t){t=t||"";var n=[];"string"!=typeof t&&(t="?");for(var o in e)i.call(e,o)&&n.push(encodeURIComponent(o)+"="+encodeURIComponent(e[o]));return n.length?t+n.join("&"):""}var i=Object.prototype.hasOwnProperty;n.stringify=r,n.parse=o},{}],8:[function(e,t,n){"use strict";function o(e,t,n){return s(e in n?n[e]:e in t?t[e]:r[e])}function r(e){var t=this;return t instanceof r?(e=e||{},t.attempt=null,t._fn=null,t["reconnect timeout"]=o("reconnect timeout",t,e),t.retries=o("retries",t,e),t.factor=o("factor",t,e),t.max=o("max",t,e),t.min=o("min",t,e),void(t.timers=new a(t))):new r(e)}var i=e("eventemitter3"),s=e("millisecond"),c=e("demolish"),a=e("tick-tock"),u=e("one-time");r.prototype=new i,r.prototype.constructor=r,r["reconnect timeout"]="30 seconds",r.max=1/0,r.min="500 ms",r.retries=10,r.factor=2,r.prototype.reconnect=function(){var e=this;return e.backoff(function(t,n){return n.duration=+new Date-n.start,t?e.emit("reconnect failed",t,n):void e.emit("reconnected",n)},e.attempt)},r.prototype.backoff=function(e,t){var n=this;return t=t||n.attempt||{},t.backoff?n:(t["reconnect timeout"]=o("reconnect timeout",n,t),t.retries=o("retries",n,t),t.factor=o("factor",n,t),t.max=o("max",n,t),t.min=o("min",n,t),t.start=+t.start||+new Date,t.duration=+t.duration||0,t.attempt=+t.attempt||0,t.attempt===t.retries?(e.call(n,new Error("Unable to recover"),t),n):(t.backoff=!0,t.attempt++,n.attempt=t,t.scheduled=1!==t.attempt?Math.min(Math.round((Math.random()+1)*t.min*Math.pow(t.factor,t.attempt-1)),t.max):t.min,n.timers.setTimeout("reconnect",function(){t.duration=+new Date-t.start,t.backoff=!1,n.timers.clear("reconnect, timeout");var o=n._fn=u(function(o){return n.reset(),o?n.backoff(e,t):void e.call(n,void 0,t)});n.emit("reconnect",t,o),n.timers.setTimeout("timeout",function(){var e=new Error("Failed to reconnect in a timely manner");t.duration=+new Date-t.start,n.emit("reconnect timeout",e,t),o(e)},t["reconnect timeout"])},t.scheduled),n.emit("reconnect scheduled",t),n))},r.prototype.reconnecting=function(){return!!this.attempt},r.prototype.reconnected=function(e){return this._fn&&this._fn(e),this},r.prototype.reset=function(){return this._fn=this.attempt=null,this.timers.clear("reconnect, timeout"),this},r.prototype.destroy=c("timers attempt _fn"),t.exports=r},{demolish:1,eventemitter3:9,millisecond:5,"one-time":6,"tick-tock":11}],9:[function(e,t,n){"use strict";function o(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function r(){}var i="function"!=typeof Object.create&&"~";r.prototype._events=void 0,r.prototype.listeners=function(e,t){var n=i?i+e:e,o=this._events&&this._events[n];if(t)return!!o;if(!o)return[];if(o.fn)return[o.fn];for(var r=0,s=o.length,c=new Array(s);r<s;r++)c[r]=o[r].fn;return c},r.prototype.emit=function(e,t,n,o,r,s){var c=i?i+e:e;if(!this._events||!this._events[c])return!1;var a,u,p=this._events[c],f=arguments.length;if("function"==typeof p.fn){switch(p.once&&this.removeListener(e,p.fn,void 0,!0),f){case 1:return p.fn.call(p.context),!0;case 2:return p.fn.call(p.context,t),!0;case 3:return p.fn.call(p.context,t,n),!0;case 4:return p.fn.call(p.context,t,n,o),!0;case 5:return p.fn.call(p.context,t,n,o,r),!0;case 6:return p.fn.call(p.context,t,n,o,r,s),!0}for(u=1,a=new Array(f-1);u<f;u++)a[u-1]=arguments[u];p.fn.apply(p.context,a)}else{var l,h=p.length;for(u=0;u<h;u++)switch(p[u].once&&this.removeListener(e,p[u].fn,void 0,!0),f){case 1:p[u].fn.call(p[u].context);break;case 2:p[u].fn.call(p[u].context,t);break;case 3:p[u].fn.call(p[u].context,t,n);break;default:if(!a)for(l=1,a=new Array(f-1);l<f;l++)a[l-1]=arguments[l];p[u].fn.apply(p[u].context,a)}}return!0},r.prototype.on=function(e,t,n){var r=new o(t,n||this),s=i?i+e:e;return this._events||(this._events=i?{}:Object.create(null)),this._events[s]?this._events[s].fn?this._events[s]=[this._events[s],r]:this._events[s].push(r):this._events[s]=r,this},r.prototype.once=function(e,t,n){var r=new o(t,n||this,!0),s=i?i+e:e;return this._events||(this._events=i?{}:Object.create(null)),this._events[s]?this._events[s].fn?this._events[s]=[this._events[s],r]:this._events[s].push(r):this._events[s]=r,this},r.prototype.removeListener=function(e,t,n,o){var r=i?i+e:e;if(!this._events||!this._events[r])return this;var s=this._events[r],c=[];if(t)if(s.fn)(s.fn!==t||o&&!s.once||n&&s.context!==n)&&c.push(s);else for(var a=0,u=s.length;a<u;a++)(s[a].fn!==t||o&&!s[a].once||n&&s[a].context!==n)&&c.push(s[a]);return c.length?this._events[r]=1===c.length?c[0]:c:delete this._events[r],this},r.prototype.removeAllListeners=function(e){return this._events?(e?delete this._events[i?i+e:e]:this._events=i?{}:Object.create(null),this):this},r.prototype.off=r.prototype.removeListener,r.prototype.addListener=r.prototype.on,r.prototype.setMaxListeners=function(){return this},r.prefixed=i,"undefined"!=typeof t&&(t.exports=r)},{}],10:[function(e,t,n){"use strict";t.exports=function(e,t){if(t=t.split(":")[0],e=+e,!e)return!1;switch(t){case"http":case"ws":return 80!==e;case"https":case"wss":return 443!==e;case"ftp":return 21!==e;case"gopher":return 70!==e;case"file":return!1}return 0!==e}},{}],11:[function(e,t,n){"use strict";function o(e,t,n,o){this.start=+new Date,this.duration=n,this.clear=t,this.timer=e,this.fns=[o]}function r(e){clearTimeout(e)}function i(e){clearInterval(e)}function s(e){clearImmediate(e)}function c(e){return this instanceof c?(this.timers={},void(this.context=e||this)):new c(e)}var a=Object.prototype.hasOwnProperty,u=e("millisecond");o.prototype.remaining=function(){return this.duration-this.taken()},o.prototype.taken=function(){return+new Date-this.start},c.prototype.tock=function(e,t){var n=this;return function(){if(e in n.timers){var o=n.timers[e],r=o.fns.slice(),i=r.length,s=0;for(t?n.clear(e):n.start=+new Date;s<i;s++)r[s].call(n.context)}}},c.prototype.setTimeout=function(e,t,n){var i,s=this;return s.timers[e]?(s.timers[e].fns.push(t),s):(i=u(n),s.timers[e]=new o(setTimeout(s.tock(e,!0),u(n)),r,i,t),s)},c.prototype.setInterval=function(e,t,n){var r,s=this;return s.timers[e]?(s.timers[e].fns.push(t),s):(r=u(n),s.timers[e]=new o(setInterval(s.tock(e),u(n)),i,r,t),s)},c.prototype.setImmediate=function(e,t){var n=this;return"function"!=typeof setImmediate?n.setTimeout(e,t,0):n.timers[e]?(n.timers[e].fns.push(t),n):(n.timers[e]=new o(setImmediate(n.tock(e,!0)),s,0,t),n)},c.prototype.active=function(e){return e in this.timers},c.prototype.clear=function(){var e,t,n,o=arguments.length?arguments:[],r=this;if(1===o.length&&"string"==typeof o[0]&&(o=o[0].split(/[, ]+/)),!o.length)for(e in r.timers)a.call(r.timers,e)&&o.push(e);for(t=0,n=o.length;t<n;t++)e=r.timers[o[t]],e&&(e.clear(e.timer),e.fns=e.timer=e.clear=null,delete r.timers[o[t]]);return r},c.prototype.adjust=function(e,t){var n,o=this,r=u(t),s=o.timers[e];return s?(n=s.clear===i,s.clear(s.timer),s.start=+new Date,s.duration=r,s.timer=(n?setInterval:setTimeout)(o.tock(e,!n),r),o):o},c.prototype.end=c.prototype.destroy=function(){return!!this.context&&(this.clear(),this.context=this.timers=null,!0)},c.Timer=o,t.exports=c},{millisecond:5}],12:[function(e,t,n){"use strict";function o(e){var t=u.exec(e);return{protocol:t[1]?t[1].toLowerCase():"",slashes:!!t[2],rest:t[3]}}function r(e,t){for(var n=(t||"/").split("/").slice(0,-1).concat(e.split("/")),o=n.length,r=n[o-1],i=!1,s=0;o--;)"."===n[o]?n.splice(o,1):".."===n[o]?(n.splice(o,1),s++):s&&(0===o&&(i=!0),n.splice(o,1),s--);return i&&n.unshift(""),"."!==r&&".."!==r||n.push(""),n.join("/")}function i(e,t,n){if(!(this instanceof i))return new i(e,t,n);var u,f,l,h,m,d,y=p.slice(),v=typeof t,g=this,w=0;for("object"!==v&&"string"!==v&&(n=t,t=null),n&&"function"!=typeof n&&(n=a.parse),t=c(t),f=o(e||""),u=!f.protocol&&!f.slashes,g.slashes=f.slashes||u&&t.slashes,g.protocol=f.protocol||t.protocol||"",e=f.rest,f.slashes||(y[2]=[/(.*)/,"pathname"]);w<y.length;w++)h=y[w],l=h[0],d=h[1],l!==l?g[d]=e:"string"==typeof l?~(m=e.indexOf(l))&&("number"==typeof h[2]?(g[d]=e.slice(0,m),e=e.slice(m+h[2])):(g[d]=e.slice(m),e=e.slice(0,m))):(m=l.exec(e))&&(g[d]=m[1],e=e.slice(0,m.index)),g[d]=g[d]||(u&&h[3]?t[d]||"":""),h[4]&&(g[d]=g[d].toLowerCase());n&&(g.query=n(g.query)),u&&t.slashes&&"/"!==g.pathname.charAt(0)&&(""!==g.pathname||""!==t.pathname)&&(g.pathname=r(g.pathname,t.pathname)),s(g.port,g.protocol)||(g.host=g.hostname,g.port=""),g.username=g.password="",g.auth&&(h=g.auth.split(":"),g.username=h[0]||"",g.password=h[1]||""),g.origin=g.protocol&&g.host&&"file:"!==g.protocol?g.protocol+"//"+g.host:"null",g.href=g.toString()}var s=e("requires-port"),c=e("./lolcation"),a=e("querystringify"),u=/^([a-z][a-z0-9.+-]*:)?(\/\/)?([\S\s]*)/i,p=[["#","hash"],["?","query"],["/","pathname"],["@","auth",1],[NaN,"host",void 0,1,1],[/:(\d+)$/,"port",void 0,1],[NaN,"hostname",void 0,1,1]];i.prototype.set=function(e,t,n){var o=this;switch(e){case"query":"string"==typeof t&&t.length&&(t=(n||a.parse)(t)),o[e]=t;break;case"port":o[e]=t,s(t,o.protocol)?t&&(o.host=o.hostname+":"+t):(o.host=o.hostname,o[e]="");break;case"hostname":o[e]=t,o.port&&(t+=":"+o.port),o.host=t;break;case"host":o[e]=t,/:\d+$/.test(t)?(t=t.split(":"),o.port=t.pop(),o.hostname=t.join(":")):(o.hostname=t,o.port="");break;case"protocol":o.protocol=t.toLowerCase(),o.slashes=!n;break;case"pathname":o.pathname="/"===t.charAt(0)?t:"/"+t;break;default:o[e]=t}for(var r=0;r<p.length;r++){var i=p[r];i[4]&&(o[i[1]]=o[i[1]].toLowerCase())}return o.origin=o.protocol&&o.host&&"file:"!==o.protocol?o.protocol+"//"+o.host:"null",o.href=o.toString(),o},i.prototype.toString=function(e){e&&"function"==typeof e||(e=a.stringify);var t,n=this,o=n.protocol;o&&":"!==o.charAt(o.length-1)&&(o+=":");var r=o+(n.slashes?"//":"");return n.username&&(r+=n.username,n.password&&(r+=":"+n.password),r+="@"),r+=n.host+n.pathname,t="object"==typeof n.query?e(n.query):n.query,t&&(r+="?"!==t.charAt(0)?"?"+t:t),n.hash&&(r+=n.hash),r},i.extractProtocol=o,i.location=c,i.qs=a,t.exports=i},{"./lolcation":13,querystringify:7,"requires-port":10}],13:[function(e,t,n){(function(n){"use strict";var o,r=/^[A-Za-z][A-Za-z0-9+-.]*:\/\//,i={hash:1,query:1};t.exports=function(t){t=t||n.location||{},o=o||e("./");var s,c={},a=typeof t;if("blob:"===t.protocol)c=new o(unescape(t.pathname),{});else if("string"===a){c=new o(t,{});for(s in i)delete c[s]}else if("object"===a){for(s in t)s in i||(c[s]=t[s]);void 0===c.slashes&&(c.slashes=r.test(t.href))}return c}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./":12}],14:[function(e,t,n){"use strict";function o(e){var t="";do t=c[e%a]+t,e=Math.floor(e/a);while(e>0);return t}function r(e){var t=0;for(f=0;f<e.length;f++)t=t*a+u[e.charAt(f)];return t}function i(){var e=o(+new Date);return e!==s?(p=0,s=e):e+"."+o(p++)}for(var s,c="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),a=64,u={},p=0,f=0;f<a;f++)u[c[f]]=f;i.encode=o,i.decode=r,t.exports=i},{}],15:[function(t,n,o){"use strict";function r(e,t){if(!(e instanceof i)){var n=new Error("Primus#"+t+"'s context should called with a Primus instance");if("function"!=typeof e.listeners||!e.listeners("error").length)throw n;e.emit("error",n)}}function i(e,t){if(!(this instanceof i))return new i(e,t);if(i.Stream.call(this),"function"!=typeof this.client){var n="The client library has not been compiled correctly, see https://github.com/primus/primus#client-library for more details";return this.critical(new Error(n))}"object"==typeof e?(t=e,e=t.url||t.uri||s):t=t||{};var o=this;t.queueSize="queueSize"in t?t.queueSize:1/0,t.timeout="timeout"in t?t.timeout:1e4,t.reconnect="reconnect"in t?t.reconnect:{},t.ping="ping"in t?t.ping:25e3,t.pong="pong"in t?t.pong:1e4,t.strategy="strategy"in t?t.strategy:[],t.transport="transport"in t?t.transport:{},o.buffer=[],o.writable=!0,o.readable=!0,o.url=o.parse(e||s),o.readyState=i.CLOSED,o.options=t,o.timers=new a(this),o.socket=null,o.latency=0,o.disconnect=!1,o.transport=t.transport,o.transformers={outgoing:[],incoming:[]},o.recovery=new u(t.reconnect),"string"==typeof t.strategy&&(t.strategy=t.strategy.split(/\s?\,\s?/g)),!1===t.strategy?t.strategy=[]:t.strategy.length||(t.strategy.push("disconnect","online"),this.authorization||t.strategy.push("timeout")),t.strategy=t.strategy.join(",").toLowerCase(),"websockets"in t&&(o.AVOID_WEBSOCKETS=!t.websockets),"network"in t&&(o.NETWORK_EVENTS=t.network),t.manual||o.timers.setTimeout("open",function(){o.timers.clear("open"),o.open()},0),o.initialise(t)}var s,c=t("eventemitter3"),a=t("tick-tock"),u=t("recovery"),p=t("querystringify"),f=t("inherits"),l=t("demolish"),h=t("yeast"),m=/\u2028/g,d=/\u2029/g;try{s=location.origin?location.origin:location.protocol+"//"+location.host}catch(e){s="http://127.0.0.1"}i.requires=i.require=function(n){if("function"==typeof t)return"function"==typeof e&&e.amd?void 0:t(n)};try{i.Stream=i.requires("stream")}catch(e){}i.Stream||(i.Stream=c),f(i,i.Stream),i.OPENING=1,i.CLOSED=2,i.OPEN=3,i.prototype.AVOID_WEBSOCKETS=!1,i.prototype.NETWORK_EVENTS=!1,i.prototype.online=!0;try{(i.prototype.NETWORK_EVENTS="onLine"in navigator&&(window.addEventListener||document.body.attachEvent))&&(navigator.onLine||(i.prototype.online=!1))}catch(e){}if(i.prototype.ark={},i.prototype.emits=t("emits"),i.prototype.plugin=function(e){if(r(this,"plugin"),e)return this.ark[e];var t={};for(e in this.ark)t[e]=this.ark[e];return t},i.prototype.reserved=function(e){return/^(incoming|outgoing)::/.test(e)||e in this.reserved.events},i.prototype.reserved.events={"reconnect scheduled":1,"reconnect timeout":1,readyStateChange:1,"reconnect failed":1,reconnected:1,reconnect:1,offline:1,timeout:1,online:1,error:1,close:1,open:1,data:1,end:1},i.prototype.initialise=function(e){var t,n=this;n.recovery.on("reconnected",n.emits("reconnected")).on("reconnect failed",n.emits("reconnect failed",function(e){n.emit("end"),e()})).on("reconnect timeout",n.emits("reconnect timeout")).on("reconnect scheduled",n.emits("reconnect scheduled")).on("reconnect",n.emits("reconnect",function(e){n.emit("outgoing::reconnect"),e()})),n.on("outgoing::open",function(){var e=n.readyState;n.readyState=i.OPENING,e!==n.readyState&&n.emit("readyStateChange","opening"),t=+new Date}),n.on("incoming::open",function(){var e=n.readyState;if(n.recovery.reconnecting()&&n.recovery.reconnected(),n.writable=!0,n.readable=!0,n.online||(n.online=!0,n.emit("online")),n.readyState=i.OPEN,e!==n.readyState&&n.emit("readyStateChange","open"),n.latency=+new Date-t,n.timers.clear("ping","pong"),n.heartbeat(),n.buffer.length){var o=n.buffer.slice(),r=o.length,s=0;for(n.buffer.length=0;s<r;s++)n._write(o[s])}n.emit("open")}),n.on("incoming::pong",function(e){n.online=!0,n.timers.clear("pong"),n.heartbeat(),n.latency=+new Date-e}),n.on("incoming::error",function(e){var t=n.timers.active("connect"),o=e;if("string"==typeof e)o=new Error(e);else if(!(e instanceof Error)&&"object"==typeof e){o=new Error(e.message||e.reason);for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(o[r]=e[r])}return n.recovery.reconnecting()?n.recovery.reconnected(o):(n.listeners("error").length&&n.emit("error",o),void(t&&(~n.options.strategy.indexOf("timeout")?n.recovery.reconnect():n.end())))}),n.on("incoming::data",function(e){n.decoder(e,function(t,o){return t?n.listeners("error").length&&n.emit("error",t):void(n.protocol(o)||n.transforms(n,n,"incoming",o,e))})}),n.on("incoming::end",function(){var e=n.readyState;return n.disconnect?(n.disconnect=!1,n.end()):(n.readyState=i.CLOSED,e!==n.readyState&&n.emit("readyStateChange","end"),n.timers.active("connect")&&n.end(),e!==i.OPEN?!!n.recovery.reconnecting()&&n.recovery.reconnect():(this.writable=!1,this.readable=!1,this.timers.clear(),n.emit("close"),~n.options.strategy.indexOf("disconnect")?n.recovery.reconnect():(n.emit("outgoing::end"),void n.emit("end"))))}),n.client();for(var o in n.ark)n.ark[o].call(n,n,e);return n.NETWORK_EVENTS?(n.offlineHandler=function(){n.online&&(n.online=!1,n.emit("offline"),n.end(),n.recovery.reset())},n.onlineHandler=function(){n.online||(n.online=!0,n.emit("online"),~n.options.strategy.indexOf("online")&&n.recovery.reconnect())},window.addEventListener?(window.addEventListener("offline",n.offlineHandler,!1),window.addEventListener("online",n.onlineHandler,!1)):document.body.attachEvent&&(document.body.attachEvent("onoffline",n.offlineHandler),document.body.attachEvent("ononline",n.onlineHandler)),n):n},i.prototype.protocol=function(e){if("string"!=typeof e||0!==e.indexOf("primus::"))return!1;var t=e.indexOf(":",8),n=e.slice(t+2);switch(e.slice(8,t)){case"pong":this.emit("incoming::pong",+n);break;case"server":"close"===n&&(this.disconnect=!0);break;case"id":this.emit("incoming::id",n);break;default:return!1}return!0},i.prototype.transforms=function(e,t,n,o,r){var i={data:o},s=e.transformers[n];return function e(n,o){var r=s[n++];if(!r)return o();if(1===r.length){if(!1===r.call(t,i))return;return e(n,o)}r.call(t,i,function(r,i){return r?t.emit("error",r):void(!1!==i&&e(n,o))})}(0,function(){return"incoming"===n?t.emit("data",i.data,r):void t._write(i.data)}),this},i.prototype.id=function(e){return this.socket&&this.socket.id?e(this.socket.id):(this._write("primus::id::"),this.once("incoming::id",e))},i.prototype.open=function(){return r(this,"open"),!this.recovery.reconnecting()&&this.options.timeout&&this.timeout(),this.emit("outgoing::open"),this},i.prototype.write=function(e){return r(this,"write"),this.transforms(this,this,"outgoing",e),!0},i.prototype._write=function(e){var t=this;return i.OPEN!==t.readyState?(this.buffer.length===this.options.queueSize&&this.buffer.splice(0,1),this.buffer.push(e),!1):(t.encoder(e,function(e,n){return e?t.listeners("error").length&&t.emit("error",e):("string"==typeof n&&(~n.indexOf("\u2028")&&(n=n.replace(m,"\\u2028")),~n.indexOf("\u2029")&&(n=n.replace(d,"\\u2029"))),void t.emit("outgoing::data",n))}),!0)},i.prototype.heartbeat=function(){function e(){n.timers.clear("pong"),n.online&&(n.online=!1,n.emit("offline"),n.emit("incoming::end"))}function t(){var t=+new Date;n.timers.clear("ping"),n._write("primus::ping::"+t),n.emit("outgoing::ping",t),n.timers.setTimeout("pong",e,n.options.pong)}var n=this;return n.options.ping?(n.timers.setTimeout("ping",t,n.options.ping),this):n},i.prototype.timeout=function(){function e(){t.removeListener("error",e).removeListener("open",e).removeListener("end",e).timers.clear("connect")}var t=this;return t.timers.setTimeout("connect",function(){e(),t.readyState===i.OPEN||t.recovery.reconnecting()||(t.emit("timeout"),~t.options.strategy.indexOf("timeout")?t.recovery.reconnect():t.end())},t.options.timeout),t.on("error",e).on("open",e).on("end",e)},i.prototype.end=function(e){if(r(this,"end"),this.readyState===i.CLOSED&&!this.timers.active("connect")&&!this.timers.active("open"))return this.recovery.reconnecting()&&(this.recovery.reset(),this.emit("end")),this;void 0!==e&&this.write(e),this.writable=!1,this.readable=!1;var t=this.readyState;return this.readyState=i.CLOSED,t!==this.readyState&&this.emit("readyStateChange","end"),this.timers.clear(),this.emit("outgoing::end"),this.emit("close"),this.emit("end"),this},i.prototype.destroy=l("url timers options recovery socket transport transformers",{before:"end",after:["removeAllListeners",function(){this.NETWORK_EVENTS&&(window.addEventListener?(window.removeEventListener("offline",this.offlineHandler),window.removeEventListener("online",this.onlineHandler)):document.body.attachEvent&&(document.body.detachEvent("onoffline",this.offlineHandler),document.body.detachEvent("ononline",this.onlineHandler)))}]}),i.prototype.clone=function(e){return this.merge({},e)},i.prototype.merge=function(e){for(var t,n,o=1;o<arguments.length;o++){n=arguments[o];for(t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[t]=n[t])}return e},i.prototype.parse=t("url-parse"),i.prototype.querystring=p.parse,i.prototype.querystringify=p.stringify,i.prototype.uri=function(e){var t=this.url,n=[],o=!1;e.query&&(o=!0),e=e||{},e.protocol="protocol"in e?e.protocol:"http:",e.query=!(!t.query||!o)&&t.query.slice(1),e.secure="secure"in e?e.secure:"https:"===t.protocol||"wss:"===t.protocol,e.auth="auth"in e?e.auth:t.auth,e.pathname="pathname"in e?e.pathname:this.pathname,e.port="port"in e?+e.port:+t.port||(e.secure?443:80),this.emit("outgoing::url",e);var r=this.querystring(e.query||"");return r._primuscb=h(),e.query=this.querystringify(r),n.push(e.secure?e.protocol.replace(":","s:"):e.protocol,""),n.push(e.auth?e.auth+"@"+t.host:t.host),e.pathname&&n.push(e.pathname.slice(1)),o?n[n.length-1]+="?"+e.query:delete e.query,e.object?e:n.join("/")},i.prototype.transform=function(e,t){return r(this,"transform"),e in this.transformers?(this.transformers[e].push(t),this):this.critical(new Error("Invalid transformer type"))},i.prototype.critical=function(e){if(this.listeners("error").length)return this.emit("error",e),this;throw e},i.connect=function(e,t){return new i(e,t)},i.EventEmitter=c,i.prototype.client=function(){var e,t=this,n=function(){if("undefined"!=typeof WebSocket)return WebSocket;if("undefined"!=typeof MozWebSocket)return MozWebSocket;try{return i.requires("ws")}catch(e){}}();return n?(t.on("outgoing::open",function(){t.emit("outgoing::end");try{var o="ws+unix:"===t.url.protocol?"ws+unix:":"ws:",r="ws:"===o;3===n.length?t.socket=e=new n(t.uri({protocol:o,query:r}),[],t.transport):(t.socket=e=new n(t.uri({protocol:o,query:r})),e.binaryType="arraybuffer")}catch(e){return t.emit("error",e)}e.onopen=t.emits("incoming::open"),e.onerror=t.emits("incoming::error"),e.onclose=t.emits("incoming::end"),e.onmessage=t.emits("incoming::data",function(e,t){e(void 0,t.data)})}),t.on("outgoing::data",function(o){if(e&&e.readyState===n.OPEN)try{e.send(o)}catch(e){t.emit("incoming::error",e)}}),t.on("outgoing::reconnect",function(){t.emit("outgoing::open")}),void t.on("outgoing::end",function(){e&&(e.onerror=e.onopen=e.onclose=e.onmessage=function(){},e.close(),e=null)})):t.critical(new Error("Missing required `ws` module. Please run `npm install --save ws`"))},i.prototype.authorization=!1,i.prototype.pathname="/primus",i.prototype.encoder=function(e,t){var n;try{e=JSON.stringify(e)}catch(e){n=e}t(n,e)},i.prototype.decoder=function(e,t){var n;if("string"!=typeof e)return t(n,e);try{e=JSON.parse(e)}catch(e){n=e}t(n,e)},i.prototype.version="6.0.5","undefined"!=typeof document&&"undefined"!=typeof navigator){document.addEventListener&&document.addEventListener("keydown",function(e){27===e.keyCode&&e.preventDefault&&e.preventDefault()},!1);var y=(navigator.userAgent||"").toLowerCase(),v=y.match(/.+(?:rv|it|ra|ie)[\/: ](\d+)\.(\d+)(?:\.(\d+))?/)||[],g=+[v[1],v[2]].join(".");!~y.indexOf("chrome")&&~y.indexOf("safari")&&g<534.54&&(i.prototype.AVOID_WEBSOCKETS=!0)}n.exports=i},{demolish:1,emits:2,eventemitter3:3,inherits:4,querystringify:7,recovery:8,"tick-tock":11,"url-parse":12,yeast:14}]},{},[15])(15);return t},[]),function(e){var t=function(e,t){var n=this;n.callbacks={},n.id=null,n.events={},n.rooms=[],n.state="disconnected",n.options=n.defaults();for(var o in e)n.options[o]=e[o];t&&(n.externalClient=!0,n.client=t)};if("undefined"==typeof Primus){var n=require("util"),o=require("events").EventEmitter;n.inherits(t,o)}else t.prototype=new Primus.EventEmitter;t.prototype.defaults=function(){return{apiPath:"/api",url:window.location.origin}},t.prototype.connect=function(e){var t=this;t.messageCount=0,t.client&&t.externalClient!==!0?(t.client.end(),t.client.removeAllListeners(),delete t.client,t.client=Primus.connect(t.options.url,t.options)):t.client&&t.externalClient===!0?(t.client.end(),t.client.open()):t.client=Primus.connect(t.options.url,t.options),t.client.on("open",function(){t.configure(function(n){"connected"===t.state||(t.state="connected","function"==typeof e&&e(null,n)),t.emit("connected")})}),t.client.on("error",function(e){t.emit("error",e)}),t.client.on("reconnect",function(){t.messageCount=0,t.emit("reconnect")}),t.client.on("reconnecting",function(){t.emit("reconnecting"),t.state="reconnecting",t.emit("disconnected")}),t.client.on("timeout",function(){t.state="timeout",t.emit("timeout")}),t.client.on("close",function(){t.messageCount=0,"disconnected"!==t.state&&(t.state="disconnected",t.emit("disconnected"))}),t.client.on("end",function(){t.messageCount=0,"disconnected"!==t.state&&(t.state="disconnected",t.emit("disconnected"))}),t.client.on("data",function(e){t.handleMessage(e)})},t.prototype.configure=function(e){var t=this;t.rooms.forEach(function(e){t.send({event:"roomAdd",room:e})}),t.detailsView(function(n){t.id=n.data.id,t.fingerprint=n.data.fingerprint,t.rooms=n.data.rooms,e(n)})},t.prototype.send=function(e,t){var n=this;n.messageCount++,"function"==typeof t&&(n.callbacks[n.messageCount]=t),n.client.write(e)},t.prototype.handleMessage=function(e){var t=this;t.emit("message",e),"response"===e.context?("function"==typeof t.callbacks[e.messageCount]&&t.callbacks[e.messageCount](e),delete t.callbacks[e.messageCount]):"user"===e.context?t.emit("say",e):"alert"===e.context?t.emit("alert",e):e.welcome&&"api"===e.context?(t.welcomeMessage=e.welcome,t.emit("welcome",e)):"api"===e.context&&t.emit("api",e)},t.prototype.action=function(e,t,n){n||"function"!=typeof t||(n=t,t=null),t||(t={}),t.action=e,"connected"!==this.state?this.actionWeb(t,n):this.actionWebSocket(t,n)},t.prototype.actionWeb=function(e,t){var n=new XMLHttpRequest;n.onreadystatechange=function(){var e;if(4===n.readyState){if(200===n.status)e=JSON.parse(n.responseText);else try{e=JSON.parse(n.responseText)}catch(t){e={error:{statusText:n.statusText,responseText:n.responseText}}}t(e)}};var o=(e.httpMethod||"POST").toUpperCase(),r=this.options.url+this.options.apiPath+"?action="+e.action;
if("GET"===o)for(var i in e)~["action","httpMethod"].indexOf(i)||(r+="&"+i+"="+e[i]);n.open(o,r,!0),n.setRequestHeader("Content-Type","application/json"),n.send(JSON.stringify(e))},t.prototype.actionWebSocket=function(e,t){this.send({event:"action",params:e},t)},t.prototype.say=function(e,t,n){this.send({event:"say",room:e,message:t},n)},t.prototype.file=function(e,t){this.send({event:"file",file:e},t)},t.prototype.detailsView=function(e){this.send({event:"detailsView"},e)},t.prototype.roomView=function(e,t){this.send({event:"roomView",room:e},t)},t.prototype.roomAdd=function(e,t){var n=this;n.send({event:"roomAdd",room:e},function(e){n.configure(function(){"function"==typeof t&&t(e)})})},t.prototype.roomLeave=function(e,t){var n=this,o=n.rooms.indexOf(e);o>-1&&n.rooms.splice(o,1),this.send({event:"roomLeave",room:e},function(e){n.configure(function(){"function"==typeof t&&t(e)})})},t.prototype.documentation=function(e){this.send({event:"documentation"},e)},t.prototype.disconnect=function(){this.state="disconnected",this.client.end(),this.emit("disconnected")};var r=t;e.ActionheroClient=t,e.actionheroClient=r}("undefined"==typeof exports?window:exports);